# 产品需求文档（PRD）— 个人物品库存与记账系统（结构化版）

1. 版本与修订历史
- V0.1（2025-10-20）：初稿（结构化版）— 模块划分、分期规划、规则定义（作者：PM）
- V0.2（待定）：补充报表口径定义与示例数据（作者：PM）
- V1.0（待定）：MVP 验收后冻结文档（作者：PM/研发）

2. 项目概述
2.1 项目背景
- 产品/业务名称：物品记账与库存助手（Inventory Tracking & Accounting）
- 年轻用户购买衣物、鞋履、配件后常随手放置，后续忘记位置与状态；亦难以量化已购资产与处置收益/损失。
- 现状痛点：物品遗忘、重复购买；闲置资产不透明；转售/处置的盈亏无数据沉淀；记账与实物台账脱节。

2.2 项目目标（可量化）
- 提升入库/出库记录效率≥30%（相较手动记事/表格）。
- 将“找不到物品”的发生率降低≥50%（以用户自报问卷估计）。
- 形成可追溯的资产与盈亏报表，月活用户 30 天留存≥25%。
- 首屏 TTIM ≤ 2s（本地），核心 API P95 ≤ 300ms（本地网络）。

2.3 目标用户画像
- 个人消费型年轻人：注重服饰搭配、常网络购物、具轻度理财意识。
- 痛点：易忘放置位置；难量化“买入成本 vs 转售”结果；记账懒惰或割裂。

2.4 名词术语解释
- 入库（IN）：购买或新增物品进入持有。
- 出库（OUT）：物品离开持有，含转售（SELL）、丢弃（DISPOSE）、赠与（GIFT）。
- 交易（InventoryTransaction）：一次针对物品的入/出/调整行为。
- 分录（LedgerEntry）：一次记账记录，借贷方向 + 账户 + 金额。
- 账户（Account）：现金/银行卡/平台等资金账户。
- 品类映射（CategoryMapping）：库存品类与记账科目对应关系。

3. 产品路线图与分期规划
3.1 V1.0（MVP）
- 核心目标：完成闭环“入库→出库→报表”，满足单用户自我管理。
- 功能模块：
  - 物品管理（CRUD、属性、图片上传）
  - 库存交易（IN/OUT/ADJUST）
  - 账户与基础记账（分录生成、列表）
  - 报表（库存价值、处置盈亏、时间趋势-基础）
  - 认证（邮箱/手机号 + 密码，单用户）
  - 搜索筛选（关键字、品类、时间、状态）

3.2 V2.0（增强）
- 核心目标：加强记账精度与易用性，丰富统计与配置。
- 功能模块：
  - 品类与科目映射管理；多账户流水核对
  - 出库-转售手续费/平台费模型；收益归集
  - 报表增强（维度组合、导出 CSV）
  - 移动端体验优化（卡片、拍照上传流程）
  - 简易标签与位置管理（衣柜/鞋盒/房间）

3.3 后续方向（V3.x）
- OCR/条码、多人共享空间、多币种、第三方二手平台连接器。

4. 功能详述（按模块分期）
4.1 物品管理（V1.0）
- 功能描述：管理物品主数据（名称、品类、品牌、尺码、颜色、购买价、购买日期、存放位置、图片）。
- 用户故事：作为用户，我希望创建/编辑物品并附带图片，以便后续查询和统计。
- 业务流程：创建物品→校验→保存→列表可见；编辑→校验→保存；删除→回收站（软删）。
- 功能需求：
  - 输入：名称(必填)、价格(≥0, 两位小数)、日期(YYYY-MM-DD)、可选属性；图片最多9张，单张≤5MB。
  - 处理：字段校验、图片压缩（前端）、服务端存储并返回URL。
  - 输出：物品详情、列表数据（分页、排序）。
- 非功能：接口P95≤300ms；图片存储容量预留；软删30天可恢复。

4.2 库存交易（V1.0）
- 功能描述：记录入库/出库/调整，驱动库存变化。
- 用户故事：作为用户，我希望便捷录入购买或处置，以自动更新库存状态。
- 业务流程：选择物品→选择交易类型→填写金额/原因→确认→生成交易记录并更新物品状态（出库后状态为REMOVED）。
- 功能需求：
  - 入库：单品一对一（MVP），数量默认为1；记录购买价、账户。
  - 出库-转售：记录售出价、手续费（V2.0增强）；计算盈亏=售出净额-成本。
  - 出库-丢弃/赠与：记录原因；计入处置损失。
  - 调整：修正错误或盘点差异，需备注。
- 非功能：幂等保护（防重复提交）；审计字段（创建人/时间）。

4.3 账户与记账（V1.0→V2.0）
- 功能描述：管理资金账户并自动生成分录，与库存事件联动。
- 用户故事：作为用户，我希望入库/出库时自动形成对应的记账分录，以便月末核对。
- 业务流程：交易发生→根据映射与账户生成分录（借贷方向）→分录列表/汇总可查。
- 功能需求：
  - 账户：新增/编辑/删除（现金、银行卡、平台）。
  - 分录：入库（借：存货/资产，贷：现金/银行）；转售（借：现金，贷：资产+收益）；丢弃（借：损失，贷：资产）。
  - 映射：品类→科目（V2.0 可维护），V1.0内置默认。
- 非功能：金额两位小数；时区一致性；导出（V2.0）。

4.4 报表（V1.0→V2.0）
- 功能描述：提供库存价值、处置盈亏、时间趋势等可视化报表。
- 用户故事：作为用户，我希望看到当前资产规模及近月盈亏趋势，以指导消费决策。
- 业务流程：选择时间/维度→查询聚合→图表/表格展示→导出（V2.0）。
- 功能需求：
  - 库存价值：当前持有物品购买成本汇总，可按品类/品牌分组。
  - 处置盈亏：转售收益、丢弃损失；支持时间对比。
  - 趋势：按月入库金额、出库金额、净额曲线。
- 非功能：分页聚合、索引优化；前端图表在移动端流畅。

4.5 认证与用户（V1.0）
- 功能描述：基础登录注册与会话管理。
- 用户故事：作为用户，我希望安全登录并仅能访问我的数据。
- 业务流程：注册→登录（JWT）→令牌续期→登出。
- 功能需求：邮箱/手机号+密码；密码强度规则；重置密码（邮件/短信占位）。
- 非功能：帐号暴力破解防护（限流/锁定）；JWT有效期与刷新机制。

4.6 搜索与筛选（V1.0）
- 功能描述：对物品与交易提供关键字搜索、筛选与排序。
- 用户故事：作为用户，我希望快速找到某件物品或某段时间的记录。
- 功能需求：名称/品牌关键字、品类、时间区间、状态、价格区间；支持多字段排序。
- 非功能：查询P95≤300ms；防 N+1 查询。

4.7 文件与图片（V1.0→V2.0）
- 功能描述：图片/小票上传与管理。
- 功能需求：前端压缩、服务端限流与大小校验；V2.0 支持批量与拖拽。
- 非功能：CDN/对象存储预留（本地开发使用本地文件系统）。

4.8 设置与映射（V2.0）
- 功能描述：维护品类树与记账科目映射、默认账户、标签与位置管理。
- 功能需求：增删改查；映射校验（避免孤儿映射）；导入导出（可选）。

5. 全局规则与规范
5.1 交互规范
- 删除操作采用二次确认；实体删除默认进入回收站，30天内可恢复。
- 表单校验错误在字段下方即时提示；成功操作展示轻提示。
- 列表支持记忆上次筛选条件；移动端优先卡片视图。

5.2 数据规范
- 日期：YYYY-MM-DD；日期时间：YYYY-MM-DD HH:mm:ss；统一时区 UTC 存储、客户端本地展示。
- 金额：Decimal(18,2)；所有金额保留两位小数；币种默认 CNY。
- 图片：JPG/PNG/WebP；最大 5MB/张，最多 9 张/物品。
- 编码：UTF-8；ID 使用 UUID（或数据库自增，后续可迁移）。

5.3 权限规则
- 角色：USER（默认）/ ADMIN（保留）。
- 用户仅可访问自身数据；管理员可进行运维操作（未来多用户场景）。
- API 需携带有效 JWT；敏感操作需校验 CSRF（前后端分离下以 JWT + SameSite 策略为主）。

6. 待定问题（Open Issues）
- 成本核算方法是否需要支持多件同款与 FIFO/LIFO（MVP 暂定单品一对一）。
- 是否引入多币种与汇率（短期不做，长期考虑）。
- 图片与小票长期存储成本及清理策略。
- 与外部二手交易平台的接口打通优先级与可行性。
- 账户对账功能的准确性要求（是否需要银行对账单导入）。

