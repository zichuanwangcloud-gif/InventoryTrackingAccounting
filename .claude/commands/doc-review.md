---
allowed-tools: Bash, Read, Write, Edit, Grep, Glob, AskUserQuestion, TodoWrite
description: Comprehensive document quality audit across the project
argument-hint: [--file <path>] [--type <type>] [--dir <path>] [--outdated]
---

# 文档治理命令

> 全面审计项目文档质量，确保文档规范、准确、可维护

## 使用方式

### Claude Code
在 Claude Code 中通过命令面板（`Cmd+Shift+P` / `Ctrl+Shift+P`）或快捷键调用此命令。

### Claude Code
在 Claude Code 中通过斜杠命令 `/doc-review` 或参数提示调用此命令。

## 功能

AI 将帮助你：

1. **全面文档扫描**：扫描项目中的所有文档文件
2. **质量评估**：从多个维度评估文档质量
3. **问题识别**：识别文档中的问题和不规范之处
4. **改进建议**：提供具体的改进建议和最佳实践
5. **生成审计报告**：生成详细的审计报告和优先级清单
6. **合规性检查**：检查文档是否符合项目规范

## 支持的文档类型

### 1. README 文档
- `README.md` - 项目主文档
- `docs/README.md` - 文档目录说明
- 各子目录的 `README.md`

### 2. API 文档
- API 接口文档
- 函数/方法文档字符串
- OpenAPI/Swagger 规范

### 3. 开发文档
- 开发指南
- 架构文档
- 设计文档
- 部署文档
- 规范驱动开发文档（`docs/dev/*/`）
- 快速规划文档（`docs/dev-lite/*/`）

### 4. 命令文档
- `.cursor/commands/*.md`
- `.ai-config/commands/*.md`

### 5. 配置文档
- 配置文件说明
- 环境变量文档
- 工具使用指南

### 6. 其他文档
- 变更日志（CHANGELOG.md）
- 贡献指南（CONTRIBUTING.md）
- 许可证说明（LICENSE）
- 计划文档（`docs/plans/*.md`）

## 审计维度

### 1. 结构完整性（Structure Completeness）

检查文档是否包含必要的结构元素：

| 文档类型 | 必需元素 | 检查项 | 权重 |
|---------|---------|--------|------|
| **README** | 标题、描述、安装、使用、贡献 | 是否有清晰的项目介绍 | 高 |
| **API 文档** | 接口说明、参数、返回值、示例 | 是否有完整的接口文档 | 高 |
| **开发文档** | 概述、架构、流程、示例 | 是否有清晰的开发指南 | 高 |
| **命令文档** | 使用方式、功能、步骤、示例 | 是否有可执行的说明 | 高 |
| **配置文档** | 配置项、说明、示例、默认值 | 是否有完整的配置说明 | 中 |
| **通用** | 标题、描述、目录、更新信息 | 是否有基本的文档结构 | 中 |

### 2. 内容质量（Content Quality）

评估文档内容的质量：

| 评估项 | 检查标准 | 权重 |
|--------|---------|------|
| **清晰度** | 描述是否清晰易懂，无歧义 | 高 |
| **完整性** | 是否覆盖所有必要信息 | 高 |
| **准确性** | 信息是否准确，无过时内容 | 高 |
| **可执行性** | 步骤是否可执行，命令是否有效 | 高 |
| **实用性** | 是否提供实用的示例和场景 | 中 |
| **结构化** | 内容组织是否合理，层次清晰 | 中 |
| **时效性** | 内容是否及时更新，无过时信息 | 中 |

### 3. 格式规范（Format Standards）

检查 Markdown 格式规范：

| 检查项 | 标准 | 权重 |
|--------|------|------|
| **标题层级** | 标题层级是否合理（不超过 6 级） | 中 |
| **代码块** | 代码块是否有语言标识，格式正确 | 高 |
| **表格** | 表格格式是否正确，对齐良好 | 中 |
| **列表** | 列表格式是否正确（有序/无序） | 中 |
| **链接** | 链接格式是否正确，链接有效 | 中 |
| **分隔线** | 使用 `---` 分隔主要章节 | 低 |
| **引用块** | 引用块格式是否正确 | 低 |
| **图片** | 图片路径是否正确，图片存在 | 中 |

### 4. 一致性（Consistency）

检查文档之间的一致性：

| 检查项 | 标准 | 权重 |
|--------|------|------|
| **风格一致** | 与其他文档的风格是否一致 | 中 |
| **术语一致** | 术语使用是否与其他文档一致 | 中 |
| **结构一致** | 文档结构是否与其他文档相似 | 低 |
| **格式一致** | 格式规范是否与其他文档一致 | 低 |
| **版本一致** | 版本号是否与其他文档一致 | 中 |

### 5. 可维护性（Maintainability）

检查文档的可维护性：

| 检查项 | 标准 | 权重 |
|--------|------|------|
| **最后更新** | 是否有最后更新时间 | 中 |
| **版本号** | 是否有版本号 | 低 |
| **维护者** | 是否有维护者信息 | 低 |
| **变更历史** | 是否有变更历史（可选） | 低 |
| **更新频率** | 文档是否定期更新 | 中 |

### 6. 准确性（Accuracy）

检查文档内容的准确性：

| 检查项 | 标准 | 权重 |
|--------|------|------|
| **代码引用** | 引用的代码路径是否存在 | 高 |
| **示例代码** | 示例代码是否可执行 | 高 |
| **版本号** | 版本号是否与项目版本一致 | 中 |
| **链接有效性** | 链接是否有效，无死链 | 中 |
| **配置准确性** | 配置说明是否与实际配置一致 | 高 |

## 执行步骤

### 1. 扫描文档文件

```bash
# 扫描项目中的 Markdown 文档
find . -name "*.md" -type f \
  -not -path "*/node_modules/*" \
  -not -path "*/.git/*" \
  -not -path "*/dist/*" \
  -not -path "*/build/*" \
  -not -path "*/.next/*" \
  -not -path "*/__pycache__/*" | sort
```

**排除项**：
- `node_modules/`、`.git/`、`dist/`、`build/` 等构建和依赖目录
- 临时文件或备份文件
- 自动生成的文档

### 2. 分类文档

根据文档路径和内容，将文档分类：

```python
# 伪代码示例
def classify_document(file_path, content):
    if 'README' in file_path:
        return 'readme'
    elif 'api' in file_path.lower() or 'swagger' in file_path.lower():
        return 'api'
    elif 'commands' in file_path:
        return 'command'
    elif 'dev' in file_path or 'docs/dev' in file_path:
        return 'dev'
    elif 'config' in file_path.lower():
        return 'config'
    else:
        return 'other'
```

### 3. 分析每个文档

对每个文档执行以下检查：

#### 3.1 结构完整性检查

```python
# 伪代码示例
def check_structure(file_path, doc_type, content):
    checks = {
        'has_title': bool(re.search(r'^#\s+.+', content, re.MULTILINE)),
        'has_description': bool(re.search(r'^>\s+.+', content, re.MULTILINE)),
    }
    
    # 根据文档类型检查特定结构
    if doc_type == 'readme':
        checks.update({
            'has_installation': bool(re.search(r'##\s+安装|##\s+Installation', content)),
            'has_usage': bool(re.search(r'##\s+使用|##\s+Usage', content)),
            'has_contributing': bool(re.search(r'##\s+贡献|##\s+Contributing', content)),
        })
    elif doc_type == 'api':
        checks.update({
            'has_endpoints': bool(re.search(r'##\s+接口|##\s+Endpoints|##\s+API', content)),
            'has_parameters': bool(re.search(r'参数|Parameters', content)),
            'has_examples': bool(re.search(r'示例|Examples', content)),
        })
    elif doc_type == 'command':
        checks.update({
            'has_usage': bool(re.search(r'##\s+使用方式|##\s+Usage', content)),
            'has_functionality': bool(re.search(r'##\s+功能|##\s+Functionality', content)),
            'has_steps': bool(re.search(r'##\s+执行步骤|##\s+Steps', content)),
        })
    
    return checks
```

#### 3.2 内容质量评估

**清晰度检查**：
- 标题是否清晰描述文档内容
- 描述是否简洁明了
- 是否有歧义或模糊表述
- 术语使用是否一致

**完整性检查**：
- 是否包含必要的使用说明
- 是否包含必要的执行步骤
- 是否包含必要的参数说明（如果有参数）
- 是否包含必要的示例

**准确性检查**：
- 检查是否有过时信息
- 检查代码路径是否正确
- 检查示例是否仍然有效
- 检查版本号是否准确
- 检查链接是否有效

**可执行性检查**：
- 代码块中的命令是否可执行
- 步骤是否清晰可操作
- 示例是否完整可用
- 配置说明是否准确

#### 3.3 格式规范检查

**Markdown 格式**：
- 标题层级是否合理（建议不超过 4 级）
- 代码块是否有语言标识
- 表格格式是否正确
- 列表格式是否正确
- 链接格式是否正确
- 图片路径是否正确

**代码块检查**：
```markdown
# 正确格式
```bash
command --option
```

# 错误格式（缺少语言标识）
```
command --option
```
```

**表格检查**：
```markdown
# 正确格式
| 列1 | 列2 |
|-----|-----|
| 值1 | 值2 |

# 错误格式（对齐问题）
|列1|列2|
|--|--|
|值1|值2|
```

**链接检查**：
- 检查相对路径链接是否有效
- 检查绝对路径链接是否有效
- 检查外部链接是否可访问（可选）

#### 3.4 一致性检查

**风格一致性**：
- 与其他文档的标题风格是否一致
- 描述格式是否一致
- 章节组织方式是否一致

**术语一致性**：
- 术语使用是否与其他文档一致
- 命令引用格式是否一致（如 `/command-name`）
- 版本号格式是否一致

**结构一致性**：
- 文档结构是否与其他文档相似
- 章节顺序是否合理

#### 3.5 可维护性检查

**维护信息**：
- 是否有最后更新时间（格式：`YYYY-MM-DD` 或 `YYYY-MM-DD HH:MM`）
- 是否有版本号（格式：`X.Y.Z`）
- 是否有维护者信息

**更新频率**：
- 检查文件最后修改时间
- 如果超过 90 天未更新，标记为"可能需要更新"
- 如果相关代码已更新但文档未更新，标记为"需要同步"

#### 3.6 准确性检查

**代码引用准确性**：
- 检查文档中引用的代码路径是否存在
- 检查代码示例是否与当前代码一致
- 检查函数/类名是否正确

**配置准确性**：
- 检查配置说明是否与实际配置文件一致
- 检查环境变量说明是否准确
- 检查默认值是否正确

**版本准确性**：
- 检查文档中的版本号是否与项目版本一致
- 检查依赖版本是否准确

### 4. 生成审计报告

生成详细的审计报告，包含：

#### 4.1 总体概览

```markdown
# 文档治理审计报告

**审计时间**: {YYYY-MM-DD HH:MM}
**审计范围**: 项目所有文档
**文档总数**: {N}
**通过率**: {X}%

## 总体评分

| 文档类型 | 文档数 | 平均分 | 优秀 | 良好 | 合格 | 需改进 | 不合格 |
|---------|--------|--------|------|------|------|--------|--------|
| README | 5 | 85/100 | 3 | 1 | 1 | 0 | 0 |
| API 文档 | 8 | 78/100 | 2 | 3 | 2 | 1 | 0 |
| 开发文档 | 12 | 82/100 | 4 | 5 | 2 | 1 | 0 |
| 命令文档 | 15 | 88/100 | 8 | 5 | 2 | 0 | 0 |
| 配置文档 | 3 | 70/100 | 0 | 1 | 1 | 1 | 0 |

## 问题统计

| 严重程度 | 数量 | 占比 |
|---------|------|------|
| 🔴 严重问题 | 12 | 5.2% |
| 🟡 改进建议 | 45 | 19.6% |
| 🟢 轻微问题 | 173 | 75.2% |
```

#### 4.2 详细问题清单

对每个文档列出发现的问题：

```markdown
## {document-path} 详细审计

### ✅ 优点
- [做得好的地方]

### ❌ 问题清单

#### 🔴 严重问题（必须修复）

1. **缺少必要的章节**
   - **位置**: 文档结构
   - **问题**: 缺少"使用方式"章节
   - **影响**: 用户无法知道如何使用
   - **建议**: 添加"使用方式"章节，说明使用方法

2. **代码示例不可执行**
   - **位置**: 示例章节
   - **问题**: 代码示例中的路径不存在
   - **影响**: 用户无法按照示例操作
   - **建议**: 更新代码示例，使用正确的路径

#### 🟡 改进建议（建议修复）

1. **缺少使用示例**
   - **位置**: 文档末尾
   - **建议**: 添加"示例"章节，提供 2-3 个使用示例

2. **格式不规范**
   - **位置**: 代码块
   - **问题**: 部分代码块缺少语言标识
   - **建议**: 为所有代码块添加语言标识（如 `bash`、`python` 等）

#### 🟢 轻微问题（可选修复）

1. **缺少维护信息**
   - **位置**: 文档末尾
   - **建议**: 添加最后更新时间和维护者信息

2. **链接可能失效**
   - **位置**: 外部链接
   - **建议**: 验证链接有效性
```

#### 4.3 改进优先级

```markdown
## 改进优先级建议

### 高优先级（立即修复）
1. README.md - 缺少安装说明
2. docs/api.md - 代码示例不可执行
3. .cursor/commands/dev.md - 缺少使用方式说明

### 中优先级（建议修复）
1. docs/dev/guide.md - 缺少使用示例
2. .ai-config/commands/explain.md - 格式不规范
3. docs/config.md - 配置说明不完整

### 低优先级（可选修复）
1. CONTRIBUTING.md - 缺少维护信息
2. docs/plans/spec.md - 版本号格式不统一
```

#### 4.4 最佳实践建议

```markdown
## 最佳实践建议

### 文档结构建议

所有文档应遵循以下基本结构：

```markdown
# 文档标题

> 简短描述（一行）

## 概述
[文档概述]

## 主要内容
[详细内容]

## 示例
[使用示例]

## 相关文档
[相关文档链接]

---

**最后更新**: YYYY-MM-DD
**维护者**: {name}
**版本**: X.Y.Z
```

### 内容质量建议

1. **清晰度**：使用简洁明了的语言，避免歧义
2. **完整性**：确保包含所有必要信息
3. **可执行性**：提供可执行的命令和示例
4. **准确性**：定期更新，确保信息准确

### 格式规范建议

1. **标题层级**：合理使用标题层级（建议不超过 4 级）
2. **代码块**：始终为代码块添加语言标识
3. **表格**：使用正确的表格格式，确保对齐
4. **链接**：使用相对路径，确保链接有效
```

### 5. 输出审计报告

将审计报告保存到文件：

```bash
# 默认输出路径
docs/audit/doc-review-{YYYYMMDD-HHMMSS}.md

# 或指定路径
--output docs/audit/doc-review-report.md
```

## 参数

### 基本参数

- `--all`: 审计所有文档（默认）
- `--file <path>`: 仅审计指定的文档
- `--type <type>`: 仅审计指定类型的文档（readme/api/dev/command/config/other）
- `--dir <path>`: 仅审计指定目录下的文档

### 过滤参数

- `--min-score <score>`: 仅显示评分低于指定分数的文档（0-100）
- `--severity <level>`: 仅显示指定严重程度的问题（critical/warning/info，默认 all）
- `--outdated`: 仅审计过时的文档（基于最后修改时间）
- `--broken-links`: 仅审计包含无效链接的文档
- `--exclude <pattern>`: 排除匹配的文件

### 操作参数

- `--fix`: 自动修复可修复的问题（如格式问题）
- `--dry-run`: 仅预览，不生成报告
- `--verify`: 验证代码引用和链接的有效性
- `--verbose`: 显示详细输出

### 输出参数

- `--output <path>`: 指定审计报告输出路径
- `--format <format>`: 指定报告格式（markdown/json，默认 markdown）
- `--summary`: 仅生成摘要报告

## 评分标准

### 结构完整性（30 分）

- 标题：5 分
- 描述：5 分
- 必要章节：15 分（根据文档类型）
- 可选章节：5 分

### 内容质量（30 分）

- 清晰度：10 分
- 完整性：10 分
- 准确性：10 分

### 格式规范（20 分）

- Markdown 格式：8 分
- 代码块格式：6 分
- 表格格式：3 分
- 其他格式：3 分

### 一致性（10 分）

- 风格一致性：5 分
- 术语一致性：3 分
- 结构一致性：2 分

### 可维护性（5 分）

- 最后更新时间：3 分
- 版本号：1 分
- 维护者：1 分

### 准确性（5 分）

- 代码引用准确性：3 分
- 链接有效性：2 分

### 总分计算

```
总分 = 结构完整性 × 0.3 + 内容质量 × 0.3 + 格式规范 × 0.2 + 一致性 × 0.1 + 可维护性 × 0.05 + 准确性 × 0.05
```

### 等级划分

- **优秀**（90-100 分）：文档质量优秀，无需改进
- **良好**（80-89 分）：文档质量良好，有少量改进空间
- **合格**（70-79 分）：文档质量合格，建议改进
- **需改进**（60-69 分）：文档质量需要改进
- **不合格**（<60 分）：文档质量不合格，需要重大改进

## 示例

### 基本使用

```bash
# 审计所有文档
/doc-review

# 仅审计指定文档
/doc-review --file README.md

# 仅审计 README 文档
/doc-review --type readme

# 仅审计过时的文档
/doc-review --outdated
```

### 高级使用

```bash
# 自动修复可修复的问题
/doc-review --fix

# 仅显示严重问题
/doc-review --severity critical

# 验证代码引用和链接
/doc-review --verify

# 预览模式（不生成报告）
/doc-review --dry-run

# 生成 JSON 格式报告
/doc-review --format json --output audit-report.json

# 仅显示评分低于 70 分的文档
/doc-review --min-score 70

# 详细输出
/doc-review --verbose
```

### 批量审计

```bash
# 审计所有 API 文档
/doc-review --type api --dir docs

# 审计所有命令文档
/doc-review --type command --dir .cursor/commands

# 审计所有开发文档
/doc-review --type dev --dir docs/dev
```

## 审计报告示例

```markdown
# 文档治理审计报告

**审计时间**: 2025-01-15 14:30:00
**审计范围**: 项目所有文档
**文档总数**: 43
**通过率**: 81.4%

## 总体评分

| 文档 | 类型 | 结构完整性 | 内容质量 | 格式规范 | 一致性 | 可维护性 | 准确性 | 总分 | 等级 |
|------|------|-----------|---------|---------|--------|---------|--------|------|------|
| README.md | README | 95/100 | 90/100 | 100/100 | 90/100 | 80/100 | 100/100 | 92/100 | ✅ 优秀 |
| docs/api.md | API | 85/100 | 85/100 | 95/100 | 85/100 | 70/100 | 90/100 | 85/100 | ✅ 良好 |
| .cursor/commands/dev.md | 命令 | 90/100 | 88/100 | 100/100 | 90/100 | 80/100 | 95/100 | 90/100 | ✅ 优秀 |
| docs/dev/guide.md | 开发 | 70/100 | 75/100 | 80/100 | 75/100 | 50/100 | 80/100 | 72/100 | ⚠️ 合格 |

## 详细问题清单

### README.md 详细审计

#### ✅ 优点
- 结构完整，包含所有必要章节
- 内容详细，步骤清晰
- 格式规范，代码块和表格格式正确
- 有维护信息（最后更新时间、版本号）

#### 🟡 改进建议

1. **缺少使用示例**
   - **位置**: 文档末尾
   - **建议**: 添加"示例"章节，提供 2-3 个使用示例

### docs/api.md 详细审计

#### ❌ 问题清单

1. **代码示例不可执行**
   - **位置**: 示例章节
   - **问题**: 代码示例中的路径不存在
   - **影响**: 用户无法按照示例操作
   - **建议**: 更新代码示例，使用正确的路径

2. **缺少维护信息**
   - **位置**: 文档末尾
   - **问题**: 没有最后更新时间和维护者信息
   - **建议**: 添加维护信息

## 改进优先级建议

### 高优先级（立即修复）
1. docs/api.md - 代码示例不可执行
2. docs/config.md - 配置说明不完整

### 中优先级（建议修复）
1. README.md - 缺少使用示例
2. docs/dev/guide.md - 格式不规范

### 低优先级（可选修复）
1. CONTRIBUTING.md - 缺少维护信息
2. docs/plans/spec.md - 版本号格式不统一

## 最佳实践建议

[最佳实践建议内容...]
```

## 最佳实践

### 定期审计

建议的审计频率：

- **每周一次**：快速扫描，识别明显问题
- **每月一次**：全面审计，生成详细报告
- **发布前**：确保所有文档质量达标
- **重大更新后**：确保文档与代码同步

### 持续改进

- **发现问题立即修复**：不要积累问题
- **参考优秀文档**：学习评分高的文档
- **保持一致性**：遵循统一的文档模板
- **定期更新**：保持文档与代码同步

### 协作维护

- **明确维护者**：每个文档应有明确的维护者
- **建立审查流程**：文档更新前进行审查
- **收集反馈**：根据用户反馈改进文档
- **版本控制**：使用 Git 管理文档版本

### 自动化检查

- **CI/CD 集成**：在 CI/CD 流程中集成文档检查
- **预提交钩子**：提交前自动检查文档格式
- **定期报告**：自动生成文档质量报告

## 注意事项

### 1. 性能考虑

- 大型项目可能包含大量文档，审计可能需要较长时间
- 可以使用 `--dir` 参数限制审计范围
- 可以使用 `--type` 参数仅审计特定类型的文档

### 2. 链接验证

- 外部链接验证可能需要网络连接
- 可以使用 `--verify` 参数启用链接验证
- 相对路径链接验证需要确保文件存在

### 3. 代码引用验证

- 代码引用验证需要访问实际代码文件
- 确保项目代码已正确加载
- 某些动态生成的代码可能无法验证

### 4. 格式修复

- 使用 `--fix` 参数可以自动修复格式问题
- 修复前建议先使用 `--dry-run` 预览
- 重要文档建议先备份

## 相关命令

- `doc-update`: 智能更新项目文档
- `review-commands`: 审计命令文档质量
- `dev-docs-update`: 更新开发文档

---

**最后更新**: 2025-11-30 16:10:35
**维护者**: Documentation Team
**版本**: 1.0.0
