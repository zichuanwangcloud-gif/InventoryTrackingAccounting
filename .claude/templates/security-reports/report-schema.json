{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://vul-ai.example.com/schemas/security-report/v1",
  "title": "Security Report Schema",
  "description": "Schema for structured security assessment reports",
  "type": "object",
  "required": ["reportId", "generatedAt", "projectInfo", "summary", "vulnerabilities"],
  "properties": {
    "reportId": {
      "type": "string",
      "pattern": "^RPT-[0-9]{4}-[0-9]{3,}$",
      "description": "Unique report identifier"
    },
    "generatedAt": {
      "type": "string",
      "format": "date-time",
      "description": "Report generation timestamp"
    },
    "projectInfo": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Project name"
        },
        "version": {
          "type": "string",
          "description": "Project version"
        },
        "repository": {
          "type": "string",
          "format": "uri",
          "description": "Repository URL"
        },
        "branch": {
          "type": "string",
          "description": "Git branch"
        },
        "commit": {
          "type": "string",
          "pattern": "^[a-f0-9]{7,40}$",
          "description": "Git commit hash"
        },
        "description": {
          "type": "string",
          "description": "Project description"
        }
      }
    },
    "summary": {
      "type": "object",
      "required": ["securityGrade", "totalVulnerabilities", "distribution"],
      "properties": {
        "securityGrade": {
          "type": "string",
          "enum": ["A", "B", "C", "D", "F"],
          "description": "Overall security grade"
        },
        "totalVulnerabilities": {
          "type": "integer",
          "minimum": 0,
          "description": "Total number of vulnerabilities"
        },
        "distribution": {
          "type": "object",
          "properties": {
            "critical": { "type": "integer", "minimum": 0 },
            "high": { "type": "integer", "minimum": 0 },
            "medium": { "type": "integer", "minimum": 0 },
            "low": { "type": "integer", "minimum": 0 },
            "info": { "type": "integer", "minimum": 0 }
          }
        },
        "topCategories": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "category": { "type": "string" },
              "count": { "type": "integer", "minimum": 0 }
            }
          }
        }
      }
    },
    "vulnerabilities": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/vulnerability"
      }
    },
    "attackPaths": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/attackPath"
      }
    },
    "recommendations": {
      "type": "object",
      "properties": {
        "immediate": {
          "type": "array",
          "items": { "type": "string" }
        },
        "shortTerm": {
          "type": "array",
          "items": { "type": "string" }
        },
        "longTerm": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "scanDuration": {
          "type": "string",
          "pattern": "^[0-9]{2}:[0-9]{2}:[0-9]{2}$"
        },
        "filesScanned": { "type": "integer", "minimum": 0 },
        "linesOfCode": { "type": "integer", "minimum": 0 },
        "toolsUsed": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    }
  },
  "definitions": {
    "vulnerability": {
      "type": "object",
      "required": ["id", "title", "severity", "status", "location"],
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^VUL-[0-9]{4}-[0-9]{3,}$",
          "description": "Unique vulnerability identifier"
        },
        "title": {
          "type": "string",
          "description": "Vulnerability title"
        },
        "severity": {
          "type": "string",
          "enum": ["critical", "high", "medium", "low", "info"],
          "description": "Vulnerability severity"
        },
        "cvss": {
          "type": "number",
          "minimum": 0,
          "maximum": 10,
          "description": "CVSS score"
        },
        "cvssVector": {
          "type": "string",
          "description": "CVSS vector string"
        },
        "cwe": {
          "type": "string",
          "pattern": "^CWE-[0-9]+$",
          "description": "CWE identifier"
        },
        "owasp": {
          "type": "string",
          "description": "OWASP category"
        },
        "status": {
          "type": "string",
          "enum": ["confirmed", "potential", "false_positive", "fixed", "wont_fix"],
          "description": "Vulnerability status"
        },
        "location": {
          "type": "object",
          "required": ["file"],
          "properties": {
            "file": { "type": "string" },
            "line": { "type": "integer", "minimum": 1 },
            "lineEnd": { "type": "integer", "minimum": 1 },
            "function": { "type": "string" },
            "class": { "type": "string" },
            "endpoint": { "type": "string" },
            "method": {
              "type": "string",
              "enum": ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS", "HEAD"]
            }
          }
        },
        "description": {
          "type": "string",
          "description": "Detailed vulnerability description"
        },
        "impact": {
          "type": "object",
          "properties": {
            "confidentiality": {
              "type": "string",
              "enum": ["none", "low", "medium", "high"]
            },
            "integrity": {
              "type": "string",
              "enum": ["none", "low", "medium", "high"]
            },
            "availability": {
              "type": "string",
              "enum": ["none", "low", "medium", "high"]
            }
          }
        },
        "evidence": {
          "$ref": "#/definitions/evidence"
        },
        "remediation": {
          "$ref": "#/definitions/remediation"
        },
        "references": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uri"
          }
        }
      }
    },
    "evidence": {
      "type": "object",
      "properties": {
        "codeSnippet": {
          "type": "string",
          "description": "Vulnerable code snippet"
        },
        "contextCode": {
          "type": "string",
          "description": "Extended code context"
        },
        "dataflow": {
          "type": "object",
          "properties": {
            "source": { "type": "string" },
            "sink": { "type": "string" },
            "transforms": {
              "type": "array",
              "items": { "type": "string" }
            },
            "diagram": { "type": "string" }
          }
        },
        "staticAnalysis": {
          "type": "object",
          "properties": {
            "astGrep": { "type": "string" },
            "grep": { "type": "string" },
            "semgrep": { "type": "string" }
          }
        },
        "poc": {
          "type": "object",
          "properties": {
            "request": {
              "type": "object",
              "properties": {
                "method": { "type": "string" },
                "url": { "type": "string" },
                "headers": {
                  "type": "object",
                  "additionalProperties": { "type": "string" }
                },
                "body": {}
              }
            },
            "response": {
              "type": "object",
              "properties": {
                "status": { "type": "integer" },
                "headers": {
                  "type": "object",
                  "additionalProperties": { "type": "string" }
                },
                "body": {}
              }
            },
            "curl": { "type": "string" },
            "python": { "type": "string" },
            "shell": { "type": "string" }
          }
        },
        "logs": {
          "type": "object",
          "properties": {
            "application": { "type": "string" },
            "database": { "type": "string" },
            "docker": { "type": "string" }
          }
        },
        "payloads": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "payload": { "type": "string" },
              "purpose": { "type": "string" },
              "result": { "type": "string" },
              "encoding": { "type": "string" }
            }
          }
        },
        "modelAnalysis": {
          "type": "object",
          "properties": {
            "reasoning": { "type": "string" },
            "exploitConditions": {
              "type": "array",
              "items": { "type": "string" }
            },
            "difficulty": {
              "type": "string",
              "enum": ["trivial", "low", "medium", "high", "expert"]
            },
            "reliability": {
              "type": "string",
              "enum": ["low", "medium", "high", "certain"]
            }
          }
        }
      }
    },
    "remediation": {
      "type": "object",
      "properties": {
        "recommendation": {
          "type": "string",
          "description": "Fix recommendation"
        },
        "fixedCode": {
          "type": "string",
          "description": "Example fixed code"
        },
        "frameworkGuidance": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "framework": { "type": "string" },
              "code": { "type": "string" },
              "explanation": { "type": "string" }
            }
          }
        },
        "configChanges": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "file": { "type": "string" },
              "change": { "type": "string" }
            }
          }
        },
        "effort": {
          "type": "string",
          "enum": ["trivial", "low", "medium", "high", "significant"]
        },
        "priority": {
          "type": "string",
          "enum": ["P0", "P1", "P2", "P3"]
        }
      }
    },
    "attackPath": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "pattern": "^AP-[0-9]{3,}$"
        },
        "name": { "type": "string" },
        "risk": {
          "type": "string",
          "enum": ["critical", "high", "medium", "low"]
        },
        "description": { "type": "string" },
        "steps": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "step": { "type": "integer" },
              "action": { "type": "string" },
              "vulnerability": { "type": "string" },
              "result": { "type": "string" }
            }
          }
        },
        "affectedVulnerabilities": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    }
  }
}
