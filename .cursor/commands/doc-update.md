# 文档更新命令

> 智能更新项目文档，保持文档与代码同步

## 使用方式

### Cursor
在 Cursor 中通过命令面板（`Cmd+Shift+P` / `Ctrl+Shift+P`）或快捷键调用此命令。

### Claude Code
在 Claude Code 中通过斜杠命令 `/doc-update` 或参数提示调用此命令。

## 功能

AI 将帮助你：

1. **识别需要更新的文档**：自动检测过时或需要更新的文档
2. **更新文档内容**：根据代码变更更新相关文档
3. **保持格式一致**：维护文档的格式和结构规范
4. **记录更新历史**：在文档中记录更新时间和变更内容
5. **验证文档完整性**：确保文档包含必要的信息

## 支持的文档类型

| 类型 | 说明 | 示例 |
|------|------|------|
| README 文档 | 项目主文档和目录说明 | `README.md`, `docs/README.md` |
| API 文档 | 接口文档和函数说明 | API 接口文档, OpenAPI/Swagger |
| 开发文档 | 开发指南和架构文档 | 开发指南, 设计文档, 部署文档 |
| 命令文档 | 命令使用说明 | `.cursor/commands/*.md` |
| 配置文档 | 配置和环境说明 | 配置文件说明, 环境变量文档 |

## 执行步骤

### 1. 检测需要更新的文档

扫描项目中的 Markdown 文档：

```bash
find . -name "*.md" -type f \
  -not -path "*/node_modules/*" \
  -not -path "*/.git/*" \
  -not -path "*/dist/*" \
  -not -path "*/build/*" | sort
```

**检测指标**：
- 文档最后修改时间 vs 相关代码最后修改时间
- 文档中引用的代码路径是否仍然存在
- 文档中的版本号是否与项目版本一致
- 文档中的示例代码是否仍然有效

### 2. 分析文档内容

**完整性检查**：
- 是否有标题和描述
- 是否有必要的章节
- 是否有使用示例
- 是否有更新历史

**准确性检查**：
- 引用的代码路径是否存在
- 示例代码是否可执行
- 版本号是否准确
- 链接是否有效

**格式检查**：
- Markdown 格式是否正确
- 代码块是否有语言标识
- 表格格式是否正确
- 标题层级是否合理

### 3. 更新文档内容

| 文档类型 | 更新重点 |
|---------|---------|
| README | 功能列表、安装说明、使用示例、项目结构 |
| API | 函数签名、参数说明、返回值、使用示例 |
| 开发文档 | 架构图、技术栈、开发流程、部署步骤 |
| 命令文档 | 功能描述、使用方式、参数说明、示例 |
| 配置文档 | 配置项说明、环境变量、使用指南 |

### 4. 添加更新历史

在每个更新的文档末尾添加更新记录：

```markdown
---

**最后更新**: YYYY-MM-DD HH:MM
**维护者**: Development Team
**版本**: X.Y.Z
```

### 5. 验证更新结果

- **格式验证**：检查 Markdown 格式、代码块、表格、链接
- **内容验证**：检查语法错误、代码可执行性、链接有效性
- **完整性验证**：检查必要章节、引用、更新历史

## 参数

| 类别 | 参数 | 说明 |
|------|------|------|
| 基本 | `--all` | 更新所有文档（默认） |
| | `--file <path>` | 仅更新指定的文档 |
| | `--type <type>` | 仅更新指定类型（readme/api/dev/command/config） |
| | `--dir <path>` | 仅更新指定目录下的文档 |
| 过滤 | `--outdated` | 仅更新过时的文档 |
| | `--broken-links` | 仅更新包含无效链接的文档 |
| | `--missing-sections` | 仅更新缺少必要章节的文档 |
| | `--exclude <pattern>` | 排除匹配的文件 |
| 操作 | `--dry-run` | 仅预览，不实际更新文档 |
| | `--verify` | 更新后验证文档完整性 |
| | `--add-history` | 添加更新历史（默认启用） |
| | `--no-backup` | 不创建备份文件 |
| 输出 | `--output <path>` | 指定更新报告输出路径 |
| | `--format <format>` | 指定报告格式（markdown/json） |
| | `--verbose` | 显示详细输出 |

## 更新策略

- **保守更新（默认）**：只更新明确需要更新的部分，保留原有结构和风格
- **全面更新（--full）**：全面重写文档内容，重新组织文档结构
- **增量更新（--incremental）**：只更新发生变化的部分，标记已过时的信息

## 示例

```bash
# 更新所有文档
/doc-update

# 更新指定的文档
/doc-update --file README.md

# 仅更新 README 文档
/doc-update --type readme

# 仅更新过时的文档
/doc-update --outdated

# 预览更新（不实际修改）
/doc-update --dry-run

# 全面更新并验证
/doc-update --full --verify

# 更新指定目录下的文档
/doc-update --dir docs/api --type api
```

## 更新报告

更新完成后会生成报告，包含：

- **更新摘要**：文档总数、已更新数量、更新类型
- **详细记录**：每个文档的更新内容和变更统计
- **验证结果**：格式检查、内容检查结果
- **改进建议**：优先级分类的建议

报告格式示例：

```markdown
# 文档更新报告

**更新时间**: 2025-01-15 14:30:00
**更新范围**: 所有文档
**文档总数**: 25
**已更新**: 8

## 更新摘要

| 文档 | 更新类型 | 更新内容 | 状态 |
|------|---------|----------|------|
| README.md | 内容更新 | 更新功能列表、安装说明 | ✅ 成功 |
| docs/api.md | 全面更新 | 重写 API 文档，添加新接口 | ✅ 成功 |
```

## 最佳实践

- **定期更新**：README 在重大功能更新时，API 文档在 API 变更时，开发文档在架构变更时
- **更新前检查**：使用 `--dry-run` 预览更新内容，确认更新策略
- **更新后验证**：使用 `--verify` 验证文档完整性，检查格式和链接
- **版本控制**：提交更新前创建备份，使用清晰的提交信息
- **协作维护**：明确文档维护者，建立文档审查流程

## 注意事项

- 更新前会自动创建备份（除非使用 `--no-backup`），备份保存在 `.backup/docs/{YYYYMMDD-HHMMSS}/`
- 更新时不会删除用户添加的注释、历史记录和重要的配置说明
- 更新时会保持原有的文档结构、格式风格和术语使用
- 更新 API 文档时，确保代码和文档同步更新，示例代码可执行

## 相关命令

- `dev-docs-update`: 更新开发文档（上下文压缩前）
- `document-overview`: 生成文档概览
- `review-commands`: 审计命令文档质量

---

**最后更新**: 2025-11-29
**维护者**: Documentation Team
**版本**: 1.0.0
